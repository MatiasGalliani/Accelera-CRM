<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Form AIFidi.it</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            width: 100%;
            margin-top: 20px;
        }
        button:hover {
            background-color: #1a252f;
        }
        .response {
            margin-top: 30px;
            padding: 20px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .privacy-checkbox {
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
        }
        .privacy-checkbox input {
            width: auto;
            margin-right: 10px;
            margin-top: 5px;
        }
        .privacy-text {
            font-size: 14px;
            line-height: 1.4;
        }
        h4 {
            margin-top: 30px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <h1>Test Form AIFidi.it</h1>
    <div class="form-container">
        <form id="leadForm">
            <h4>Dati Personali</h4>
            <div class="form-group">
                <label for="firstName">Nome *</label>
                <input type="text" id="firstName" name="firstName" required>
            </div>
            <div class="form-group">
                <label for="lastName">Cognome *</label>
                <input type="text" id="lastName" name="lastName" required>
            </div>
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Telefono *</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <h4>Dati Aziendali</h4>
            <div class="form-group">
                <label for="companyName">Nome Azienda *</label>
                <input type="text" id="companyName" name="nomeAzienda" required>
            </div>
            <div class="form-group">
                <label for="legalCity">Città Sede Legale *</label>
                <input type="text" id="legalCity" name="cittaSedeLegale" required>
            </div>
            <div class="form-group">
                <label for="operationalCity">Città Sede Operativa</label>
                <input type="text" id="operationalCity" name="cittaSedeOperativa">
            </div>

            <h4>Informazioni sul Finanziamento</h4>
            <div class="form-group">
                <label for="requestedAmount">Importo Richiesto (€) *</label>
                <input type="number" id="requestedAmount" name="importoRichiesto" min="5000" required>
            </div>
            <div class="form-group">
                <label for="financingPurpose">Scopo del Finanziamento *</label>
                <select id="financingPurpose" name="scopoFinanziamento" required>
                    <option value="">Seleziona uno scopo</option>
                    <option value="Investimenti in macchinari">Investimenti in macchinari</option>
                    <option value="Ristrutturazione immobiliare">Ristrutturazione immobiliare</option>
                    <option value="Ampliamento attività">Ampliamento attività</option>
                    <option value="Liquidità">Liquidità</option>
                    <option value="Acquisto scorte">Acquisto scorte</option>
                    <option value="Altro">Altro</option>
                </select>
            </div>
            <div class="form-group">
                <label for="message">Messaggio</label>
                <textarea id="message" name="message" rows="4"></textarea>
            </div>

            <div class="privacy-checkbox">
                <input type="checkbox" id="privacy" name="privacy" required>
                <div class="privacy-text">
                    <label for="privacy">Accetto la Privacy Policy *</label>
                    <p>Acconsento al trattamento dei miei dati personali ai sensi del GDPR e del D.Lgs. 196/2003 ai fini dell'utilizzo di questo form di contatto. I dati saranno utilizzati solo per rispondere alla tua richiesta.</p>
                </div>
            </div>

            <button type="submit">Invia Richiesta</button>
        </form>

        <div id="response" class="response">
            <h3 id="responseTitle"></h3>
            <p id="responseMessage"></p>
            <pre id="responseData"></pre>
        </div>
    </div>

    <script>
        // Pre-fill form with test data
        window.addEventListener('DOMContentLoaded', function() {
            // Pre-fill personal data
            document.getElementById('firstName').value = 'Mario';
            document.getElementById('lastName').value = 'Rossi';
            document.getElementById('email').value = 'mario.rossi@example.com';
            document.getElementById('phone').value = '3331234567';
            
            // Pre-fill company data
            document.getElementById('companyName').value = 'Rossi Enterprises SRL';
            document.getElementById('legalCity').value = 'Milano';
            document.getElementById('operationalCity').value = 'Torino';
            
            // Pre-fill financing information
            document.getElementById('requestedAmount').value = '50000';
            document.getElementById('financingPurpose').value = 'Investimenti in macchinari';
            document.getElementById('message').value = 'Richiesta di test per verifica funzionamento form.';
            
            // Check privacy checkbox
            document.getElementById('privacy').checked = true;
        });

        document.getElementById('leadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const leadData = {
                source: 'aifidi',
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                message: formData.get('message'),
                nomeAzienda: formData.get('nomeAzienda'),
                cittaSedeLegale: formData.get('cittaSedeLegale'),
                cittaSedeOperativa: formData.get('cittaSedeOperativa'),
                importoRichiesto: formData.get('importoRichiesto'),
                scopoFinanziamento: formData.get('scopoFinanziamento'),
                privacyAccettata: formData.get('privacy') === 'on'
            };

            fetch('http://localhost:3000/api/leads/webhook', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': 'dev-api-key-123' // Use the development API key
                },
                body: JSON.stringify(leadData)
            })
            .then(response => response.json())
            .then(data => {
                const responseElement = document.getElementById('response');
                const responseTitleElement = document.getElementById('responseTitle');
                const responseMessageElement = document.getElementById('responseMessage');
                const responseDataElement = document.getElementById('responseData');

                responseElement.style.display = 'block';
                
                if (data.success) {
                    responseElement.className = 'response success';
                    responseTitleElement.textContent = 'Richiesta inviata con successo!';
                    responseMessageElement.textContent = 'Grazie per la tua richiesta. Ti contatteremo al più presto.';
                } else {
                    responseElement.className = 'response error';
                    responseTitleElement.textContent = 'Errore!';
                    responseMessageElement.textContent = 'Si è verificato un errore durante l\'invio della richiesta. Riprova più tardi.';
                }
                
                responseDataElement.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    document.getElementById('leadForm').reset();
                }
            })
            .catch(error => {
                const responseElement = document.getElementById('response');
                const responseTitleElement = document.getElementById('responseTitle');
                const responseMessageElement = document.getElementById('responseMessage');

                responseElement.style.display = 'block';
                responseElement.className = 'response error';
                responseTitleElement.textContent = 'Errore!';
                responseMessageElement.textContent = 'Si è verificato un errore durante l\'invio della richiesta. Controlla la console per i dettagli.';
                
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>